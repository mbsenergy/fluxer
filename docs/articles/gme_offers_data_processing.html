<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>GME Offers Data Processing • fluxer</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="gme_offers_data_processing_files/libs/quarto-html/popper.min.js"></script><script src="gme_offers_data_processing_files/libs/quarto-html/tippy.umd.min.js"></script><link href="gme_offers_data_processing_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="gme_offers_data_processing_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="GME Offers Data Processing">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fluxer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/data_query_example.html">Querying Data with Filters</a></li>
    <li><a class="dropdown-item" href="../articles/entsoe_data_processing.html">DAM Prices Retrieval and Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/gme_offers_data_processing.html">GME Offers Data Processing</a></li>
    <li><a class="dropdown-item" href="../articles/gme_prices_data_processing.html">GME Prices Data Processing</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mbsenergy/fluxer/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>GME Offers Data Processing</h1>




      <small class="dont-index">Source: <a href="https://github.com/mbsenergy/fluxer/blob/HEAD/vignettes/gme_offers_data_processing.qmd" class="external-link"><code>vignettes/gme_offers_data_processing.qmd</code></a></small>
      <div class="d-none name"><code></code></div>
    </div>






    <section class="level2"><h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette demonstrates how to download and process GME (Gestore dei Mercati Energetici) offers data for both MGP (Mercato Giornaliero di Produzione) and MSD (Mercato dei Servizi di Dispacciamento). The data is retrieved from a remote FTP server and processed into clean datasets.</p>
<p>The code is divided into two parts: 1. <strong>MGP Offers</strong>: Download and process MGP offers. 2. <strong>MSD Offers</strong>: Download and process MSD offers.</p>
</section><section class="level2"><h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>We first define the parameters required for downloading and processing the files. The data types, FTP credentials, and output directory are set as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mbsenergy.github.io/fluxer/">fluxer</a></span><span class="op">)</span></span>
<span><span class="co"># Set the parameters for both MGP and MSD</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">2</span>  <span class="co"># Number of files to process</span></span>
<span></span>
<span><span class="va">data_type_mgp</span> <span class="op">&lt;-</span> <span class="st">'MGP'</span></span>
<span><span class="va">data_type_msd</span> <span class="op">&lt;-</span> <span class="st">'MSD'</span></span>
<span></span>
<span><span class="va">username</span> <span class="op">&lt;-</span> <span class="st">"PIASARACENO"</span></span>
<span><span class="va">password</span> <span class="op">&lt;-</span> <span class="st">"18N15C9R"</span></span>
<span><span class="va">output_dir</span> <span class="op">&lt;-</span> <span class="st">"inst/data"</span></span></code></pre></div>
</div>
</section><section class="level2"><h2 id="mgp-offers">1. MGP Offers<a class="anchor" aria-label="anchor" href="#mgp-offers"></a>
</h2>
<section class="level3"><h3 id="get-available-files">1.1 Get Available Files<a class="anchor" aria-label="anchor" href="#get-available-files"></a>
</h3>
<p>We use the function <code><a href="../reference/gme_offers_get_files.html">gme_offers_get_files()</a></code> to list all available MGP files in the GME folder. We then select the last n files for processing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get MGP offers files available at GME folder</span></span>
<span><span class="va">gme_mgp_offers_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gme_offers_get_files.html">gme_offers_get_files</a></span><span class="op">(</span>data_type <span class="op">=</span> <span class="va">data_type_mgp</span>, </span>
<span>                                             output_dir <span class="op">=</span> <span class="va">output_dir</span>, </span>
<span>                                             username <span class="op">=</span> <span class="va">username</span>, </span>
<span>                                             password <span class="op">=</span> <span class="va">password</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Select the last n files</span></span>
<span><span class="va">last_n_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">gme_mgp_offers_files</span>, <span class="va">n</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">last_n_files</span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="level3"><h3 id="download-and-clean-data">1.2 Download and Clean Data<a class="anchor" aria-label="anchor" href="#download-and-clean-data"></a>
</h3>
<p>We then download and process the data from the selected MGP files using the function <code><a href="../reference/gme_download_offers_file.html">gme_download_offers_file()</a></code>. The downloaded data is cleaned and combined into a single dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">list_mgp_offers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">last_n_files</span>, <span class="kw">function</span><span class="op">(</span><span class="va">file</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>        <span class="co"># Call gme_download_offers_file with explicit arguments</span></span>
<span>        <span class="fu"><a href="../reference/gme_download_offers_file.html">gme_download_offers_file</a></span><span class="op">(</span></span>
<span>            filename <span class="op">=</span> <span class="va">file</span>,</span>
<span>            data_type <span class="op">=</span> <span class="va">data_type_mgp</span>,</span>
<span>            output_dir <span class="op">=</span> <span class="va">output_dir</span>,</span>
<span>            username <span class="op">=</span> <span class="va">username</span>,</span>
<span>            password <span class="op">=</span> <span class="va">password</span>,</span>
<span>            raw <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="co"># In case of an error, return NULL</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Error processing file: "</span>, <span class="va">file</span>, <span class="st">" - "</span>, <span class="va">e</span><span class="op">$</span><span class="va">message</span><span class="op">)</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine the downloaded MGP offers into a single data.table</span></span>
<span><span class="va">dt_mgp_offers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/rbindlist.html" class="external-link">rbindlist</a></span><span class="op">(</span><span class="va">list_mgp_offers</span>, fill <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">dt_mgp_offers</span><span class="op">)</span></span></code></pre></div>
</div>
</section></section><section class="level2"><h2 id="msd-offers">2. MSD Offers<a class="anchor" aria-label="anchor" href="#msd-offers"></a>
</h2>
<section class="level3"><h3 id="get-available-files-1">2.1 Get Available Files<a class="anchor" aria-label="anchor" href="#get-available-files-1"></a>
</h3>
<p>Similar to the MGP process, we retrieve the available MSD offers files and select the last n files for processing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mbsenergy.github.io/fluxer/">fluxer</a></span><span class="op">)</span></span>
<span><span class="co"># Get MSD offers files available at GME folder</span></span>
<span><span class="va">gme_msd_offers_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gme_offers_get_files.html">gme_offers_get_files</a></span><span class="op">(</span>data_type <span class="op">=</span> <span class="va">data_type_msd</span>, </span>
<span>                                             output_dir <span class="op">=</span> <span class="va">output_dir</span>, </span>
<span>                                             username <span class="op">=</span> <span class="va">username</span>, </span>
<span>                                             password <span class="op">=</span> <span class="va">password</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Select the last n files</span></span>
<span><span class="va">last_n_files_msd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">gme_msd_offers_files</span>, <span class="va">n</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">last_n_files_msd</span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="level3"><h3 id="download-and-clean-data-1">2.2 Download and Clean Data<a class="anchor" aria-label="anchor" href="#download-and-clean-data-1"></a>
</h3>
<p>We download and clean the MSD offers data in the same manner as the MGP offers data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">list_msd_offers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">last_n_files_msd</span>, <span class="kw">function</span><span class="op">(</span><span class="va">file</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>        <span class="co"># Call gme_download_offers_file with explicit arguments</span></span>
<span>        <span class="fu"><a href="../reference/gme_download_offers_file.html">gme_download_offers_file</a></span><span class="op">(</span></span>
<span>            filename <span class="op">=</span> <span class="va">file</span>,</span>
<span>            data_type <span class="op">=</span> <span class="va">data_type_msd</span>,</span>
<span>            output_dir <span class="op">=</span> <span class="va">output_dir</span>,</span>
<span>            username <span class="op">=</span> <span class="va">username</span>,</span>
<span>            password <span class="op">=</span> <span class="va">password</span>,</span>
<span>            raw <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="co"># In case of an error, return NULL</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Error processing file: "</span>, <span class="va">file</span>, <span class="st">" - "</span>, <span class="va">e</span><span class="op">$</span><span class="va">message</span><span class="op">)</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine the downloaded MSD offers into a single data.table</span></span>
<span><span class="va">dt_msd_offers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/rbindlist.html" class="external-link">rbindlist</a></span><span class="op">(</span><span class="va">list_msd_offers</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">dt_msd_offers</span><span class="op">)</span></span></code></pre></div>
</div>
</section></section><section class="level2"><h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>This vignette demonstrated how to download and process GME offers data for both MGP and MSD. By using FTP credentials and defining the necessary parameters, the data is cleaned and combined into two datasets: one for MGP offers and one for MSD offers.</p>
<p>You can customize the number of files to process by adjusting the parameter n and modify the data processing functions to meet your specific needs.</p>
<p>Don’t forget to handle errors gracefully in case any file fails to download or process.</p>
</section><section class="level2"><h2 id="additional-notes">Additional Notes<a class="anchor" aria-label="anchor" href="#additional-notes"></a>
</h2>
<ul>
<li>Make sure to replace the FTP <code>username</code> and <code>password</code> with your actual credentials.<br>
</li>
<li>The data is saved to the directory defined by <code>output_dir</code>, which is <code>inst/data</code> by default.<br>
</li>
<li>You can modify the <code><a href="../reference/gme_offers_get_files.html">gme_offers_get_files()</a></code> and <code><a href="../reference/gme_download_offers_file.html">gme_download_offers_file()</a></code> functions to include additional functionality or error handling if needed.</li>
</ul></section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Alejandro Abraham.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
